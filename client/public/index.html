<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover" />
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#cf292c" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1e293b" media="(prefers-color-scheme: dark)" />
    <meta name="description" content="Chez Antoine - Au service du bon. Gestion du planning et pointage." />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="Chez Antoine" />
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Chez Antoine" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/app-icon-512.png" />
    
    <!-- Android Meta Tags -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-TileColor" content="#cf292c" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- Splash Screens iOS (optionnel, am√©liore l'exp√©rience) -->
    <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/logo3.png" />
    
    <!-- Manifest PWA -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Preconnect pour performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    
    <!-- FullCalendar styles (via CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.11/index.global.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.11/index.global.min.css" rel="stylesheet">
    
    <title>Chez Antoine</title>
    
    <style>
      /* ============================================
         SPLASH SCREEN MODERNE - MonPlanning PWA
         Style inspir√© des apps iOS/Android modernes
         ============================================ */
      
      :root {
        --brand-primary: #cf292c;
        --brand-dark: #a01f22;
        --brand-light: #ff4145;
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Background blanc par d√©faut */
      html, body {
        min-height: 100%;
        min-height: 100dvh;
        background: #ffffff;
      }

      /* Dark mode pour les pages app */
      @media (prefers-color-scheme: dark) {
        html.app-loaded,
        html.app-loaded body {
          background: #0f172a;
        }
      }

      /* Page login: fond rose (activ√© via JS) */
      html.login-page,
      html.login-page body {
        background: linear-gradient(to bottom right, #fee2e2, #fecaca) !important;
      }
      
      /* Splash screen - fond BLANC avec extension pour couvrir home indicator iOS */
      #splash-screen {
        position: fixed;
        top: -50px;
        left: 0;
        right: 0;
        bottom: -50px;
        background: #ffffff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        overflow: hidden;
      }
      
      #splash-screen.fade-out {
        animation: splashFadeOut 0.4s ease-out forwards;
      }
      
      @keyframes splashFadeOut {
        to { opacity: 0; pointer-events: none; }
      }
      
      @keyframes bounce {
        0%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-8px); }
      }

      /* R√©duction animations si l'utilisateur le demande */
      @media (prefers-reduced-motion: reduce) {
        * { animation-duration: 0.001ms !important; }
        #splash-screen.fade-out { animation: none; opacity: 0; }
      }
    </style>
  </head>
  <body>
    <!-- Splash Screen HTML - Couvre le chargement avant React (PWA) -->
    <div id="splash-screen" role="status" aria-live="polite" aria-label="Chargement de l'application">
      <img src="/logo.png" alt="Logo" style="width: 280px; height: 280px; object-fit: contain;" />
      <div style="display: flex; gap: 6px; margin-top: 40px;">
        <div style="width: 8px; height: 8px; background: #cf292c; border-radius: 50%; animation: bounce 1s infinite;"></div>
        <div style="width: 8px; height: 8px; background: #cf292c; border-radius: 50%; animation: bounce 1s infinite 0.15s;"></div>
        <div style="width: 8px; height: 8px; background: #cf292c; border-radius: 50%; animation: bounce 1s infinite 0.3s;"></div>
      </div>
    </div>
    
    <noscript>Vous devez activer JavaScript pour utiliser cette application.</noscript>
    <div id="root"></div>
    
    <!-- Enregistrement du Service Worker -->
    <script>
      // Splash screen: dispara√Æt quand l'app React est r√©ellement pr√™te,
      // avec un minimum de dur√©e et un fallback de s√©curit√©.
      (function () {
        var splash = document.getElementById('splash-screen');
        if (!splash) return;

        // Sur la page Badgeuse (tablette standalone), pas de splash
        if (window.location.pathname === '/badgeuse') {
          splash.parentNode.removeChild(splash);
          return;
        }

        var startedAt = Date.now();
        var MIN_SHOW_MS = 700;
        var MAX_WAIT_MS = 8000;
        var removed = false;

        function removeSplash() {
          if (removed) return;
          removed = true;

          var elapsed = Date.now() - startedAt;
          var delay = Math.max(0, MIN_SHOW_MS - elapsed);

          setTimeout(function () {
            if (!splash) return;
            splash.classList.add('fade-out');
            setTimeout(function () {
              if (splash && splash.parentNode) splash.parentNode.removeChild(splash);
            }, 650);
          }, delay);
        }

        // Expose un hook au cas o√π (debug)
        window.__HIDE_SPLASH__ = removeSplash;

        // Signal envoy√© depuis React (index.js)
        window.addEventListener('app:ready', removeSplash, { once: true });

        // Fallback: ne jamais bloquer l'utilisateur si un script plante
        window.addEventListener('load', function () {
          setTimeout(removeSplash, MAX_WAIT_MS);
        });
      })();

      // Enregistrer le Service Worker (sans rechargement auto)
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
              console.log('‚úÖ Service Worker enregistr√©:', registration.scope);
            })
            .catch(function(error) {
              console.log('‚ùå Service Worker erreur:', error);
            });
        });
      }

      // D√©tecter le mode standalone (install√©)
      if (window.matchMedia('(display-mode: standalone)').matches) {
        console.log('üì± App lanc√©e en mode standalone (PWA install√©e)');
      }
    </script>
  </body>
</html>
